{% load i18n %}
{% for security_objective, maturity_levels in security_objectives.items %}
<div class="page-landscape">
  <div class="d-flex">
    <div class="me-auto">
      <h5 id="{{ security_objective.unique_code }}" class="fw-bold m-0">
        {{ security_objective.unique_code }}: {{ security_objective.objective }}
      </h5>
      <h6 class="card-subtitle mb-3 text-muted">{{ security_objective.description }}</h6>
    </div>
    {% if is_regulator %}
    <div class="col-2 text-end">
      {% if security_objective.status %}
      <h5 class="fw-bold m-0 
        {% if security_objective.status.status == 'PASS' %}text-success
        {% elif security_objective.status.status == 'FAIL' %}text-danger
        {% else %}text-dark{% endif %}">
        [{{ security_objective.status.get_status_display }}]
      </h5>
      <h6 class="card-subtitle text-end text-muted py-1 m-0">
        {% translate "Score" %} : {{ security_objective.score|default:0|floatformat:"2" }}
      </h6>
      {% else %}
      <h5 class="fw-bold m-0">
        [{% translate "Not reviewed" %}]
      </h5>
      {% endif %}
    </div>
    {% endif %}
  </div>
  <table class="table table-sm table-hover small">
    <thead>
      <tr>
        <th class="col-1 text-center align-middle">
          {% translate "Level" %}
        </th>
        <th class="col-3 text-center align-middle">
          {% translate "Security Measure" %}
        </th>
        <th class="col-3 text-center align-middle">
          {% translate "Evidence" %}
        </th>
        <th class="col-1 text-center align-middle">
          {% translate "Measure in place ?" %}
        </th>
        <th class="{% if is_regulator %}col-2{% else %}col-4{% endif %} text-center align-middle">
          {% translate "Comment" %}
        </th>
        {% if is_regulator %}
        <th class="col-2 text-center align-middle">
          {% translate "Review Comment" %}
        </th>
        {% endif %}
      </tr>
    </thead>
    <tbody>
      {% for maturity_level, measures in maturity_levels.items %}
      {% for measure in measures %}
      <tr>
        {% if forloop.first %}
        <th rowspan="{{ measures|length }}" class="col-1 table-group-divider text-center align-middle lh-sm">
          {{ maturity_level }}
        </th>
        {% endif %}
        <td class="col-3 lh-sm {% if forloop.first %}table-group-divider{% endif %}">
          {{ measure }}
        </td>
        <td class="col-3 lh-sm {% if forloop.first %}table-group-divider{% endif %}">
          {{ measure.evidence|linebreaksbr }}
        </td>
        <td class="col-1 align-middle {% if forloop.first %}table-group-divider{% endif %}">
          {% if not forloop.parentloop.first %}
          <div class="d-flex justify-content-center">
            <input type="checkbox" class="form-check-input {% if measure.is_implemented %}checked{% else %}not-checked{% endif %}">
          </div>
          {% endif %}
        </td>
        <td class="{% if is_regulator %}col-2{% else %}col-4{% endif %} lh-sm {% if forloop.first %}table-group-divider{% endif %}">
          {{ measure.comment|default:""|linebreaksbr }}
        </td>
        {% if is_regulator %}
        <td class="col-2 lh-sm {% if forloop.first %}table-group-divider{% endif %}">
          {{ measure.review_comment|default:""|linebreaksbr }}
        </td>
        {% endif %}
      </tr>
      {% empty %}
      <h3>{% translate "No security measures data" %}</h3>
      {% endfor %}
      {% endfor %}
    </tbody>
  </table>
  {% if not forloop.last %}
    <p class="page-break"></p>
  {% endif %}
  {% empty %}
  <h3>{% translate "No security objectives data" %}</h3>
</div>
{% endfor %}
